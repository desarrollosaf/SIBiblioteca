<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<div class="fondo-con-overlay">
    <form [formGroup]="formRegistros" class="forms-sample" >
        <div class="row" style="padding: 45px;">
            <div class="col-md-1"></div>
            <div class="col-md-9 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-12">
                                <h4> Buscador</h4><br>
                                <b>Instrucciones: </b><p>Ingresa un parámetro de búsqueda en el campo que se encuentra disponible.</p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <input type="text" formControlName="busqueda" (keyup)="buscar()" class="form-control" >
                            </div>
                        </div>
                        <br>
                    </div>
                    <div class="card-body">
                        <div *ngIf="resultados?.length > 0">
                            <h5 style="text-align: center;">Resultados encontrados:</h5><br>
                            <div class="row">
                                <div *ngFor="let item of resultados" class="resultado-item col-md-4 ">
                                    <div class="col-md-12 fondo"  style="border: 2px solid rgb(41, 41, 43); border-radius: 20px; padding: 10px; background-color: rgb(238, 233, 233);">
                                        <p style="text-align: center;"><strong>{{ item.nombre_exp }}</strong></p>
                                        <p><strong>Clasificación:</strong> {{ item.m_seccion.seccion }} / {{item.m_serie.serie}} / {{item.m_subserie.subserie}}</p>
                                        <p><strong>Clave:</strong> {{ item.clave }}</p>
                                        <p><strong>Ubicación:</strong> {{ item.ubicacion }}</p>
                                        <p><strong>Año:</strong> {{ item.anio }}</p>
                                        <p><strong>Tomo:</strong> {{ item.tomo }}</p>
                                        <p><strong>Número de expediente:</strong> {{ item.num_exp }}</p>
                                        <p><strong>Fecha inicial:</strong> {{ item.fecha_inicial }}</p>
                                        <p><strong>Fecha final:</strong> {{ item.fecha_final }}</p>
                                        <p><strong>Institución:</strong> {{ item.institucion }}</p>
                                        <p><strong>Fojas:</strong> {{ item.fojas }}</p>
                                        <p><strong>Observaciones:</strong> {{ item.observaciones }}</p>
                                        <p><strong>Estado documento:</strong> {{ item.estado_doc }}</p>
                                        <p><strong>Caracteristicas:</strong> {{ item.caracteristicas_externas_doc }}</p>
                                        <p><strong>Caracteristicas:</strong> {{ item.caracteristicas_externas_doc }}</p>
                                        <p><strong>Tipo de acceso:</strong> {{ item.m_acceso.tipo }}</p>
                                        <hr>
                                        <div class="d-flex justify-content-center mt-3">
                                            <button type="submit" class="btn btn-primary btn-icon-text" (click)="openSmModal(smModal, item.id)">Solicitar visualización</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                            <!-- Si no hay resultados -->
                        <div *ngIf="resultados?.length === 0">
                            <h5 style="text-align: center;">No se encontraron resultados.</h5>
                        </div>
                    </div>

                    <ng-template #smModal let-modal>
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Registro de solicitud </h5>
                            <button type="button" class="btn-close" (click)="modal.close('by: close icon')" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form [formGroup]="formSolicitud" (ngSubmit)="addSolicitud()" class="forms-sample">
                                <div class="row">
                                    <div class="col-md-12 grid-margin stretch-card">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <label> Nombre completo: </label>
                                                        <input type="hidden" formControlName="idRegistro" class="form-control">
                                                        <input type="text" formControlName="nombre_completo" class="form-control">
                                                        <div *ngIf="nombre?.invalid && (nombre?.dirty || nombre?.touched)" class="text-danger">
                                                            <div *ngIf="nombre?.errors?.['required']">El nombre es obligatorio.</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label> Telefono: </label>
                                                        <input type="text" formControlName="telefono" class="form-control">
                                                        <div *ngIf="telefono?.invalid&& (telefono?.dirty|| telefono?.touched)" class="text-danger">
                                                            <div *ngIf="telefono?.errors?.['required']">El telefóno es obligatorio.</div>
                                                            <div *ngIf="telefono?.errors?.['maxlength']">Máximo {{ telefono?.errors?.['maxlength'].requiredLength }} digitos.</div>
                                                            <div *ngIf="telefono?.errors?.['minlength']">Mínimo {{ telefono?.errors?.['mixlength'].requiredlength }} digitos.</div>
                                                            <div *ngIf="telefono?.errors?.['pattern']">Solo se permiten números</div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label> Correo electrónico: </label>
                                                        <input type="text" formControlName="correo" class="form-control">
                                                        <div *ngIf="correo?.invalid && (correo?.dirty || correo?.touched)" class="text-danger">
                                                            <div *ngIf="correo?.errors?.['required']">El correo es obligatorio.</div>
                                                            <div *ngIf="correo?.errors?.['email']">El formato del correo no es válido.</div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <label> Confirma correo electrónico: </label>
                                                        <input type="text" formControlName="confirma_correo" class="form-control">
                                                    </div>
                                                    <div *ngIf="formSolicitud.errors?.correosNoCoinciden && formSolicitud.touched" class="text-danger">
                                                        Los correos no coinciden
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" (click)="modal.close('by: close button')">Cancelar</button>
                            <button type="submit" (click)="addSolicitud()" [disabled]="formSolicitud.invalid" class="btn btn-primary btn-icon-text">Guardar</button>
                        </div>
                    </ng-template>
                </div>
            </div>
        </div>
    </form>
</div>